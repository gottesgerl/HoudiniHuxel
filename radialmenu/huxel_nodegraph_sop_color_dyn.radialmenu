{
	"fileversion":"20.5.304",
	"name":"huxel_nodegraph_sop_color_dyn",
	"categories":"Standard",
	"pane":"network",
	"label":"Huxel - Nodegraph - SOP - color (dyn)",
	"type":"script_submenu",
	"script":"# Fill the cardinal directions (N, S, E, W) first, then the diagonals\nslots = (\"sw\", \"se\", \"e\", \"w\", \"nw\", \"ne\", \"n\", \"s\")\n\n# Collect pane info\ndesktop = hou.ui.curDesktop()\np = hou.ui.paneUnderCursor()\npp = p.currentTab()\n\n# Get closest node\ncp = pp.cursorPosition(confine_to_view=False)\ncp_screen = pp.posToScreen(cp)\npane_size = pp.size()\npath = pp.pwd().path()\n\npos1 = hou.Vector2(0,0)\npos2 = hou.Vector2(pane_size[0], pane_size[1])\nallItems = pp.networkItemsInBox(pos1, pos2, for_drop=\"False\", for_select=\"False\")\nallNodes = [ i[0] for i in allItems if i[1]=='node']\nallDistances = { i:i.position().distanceTo(cp) for i in allNodes }\nnodesByDistance = {k: v for k, v in sorted(allDistances.items(), key=lambda item: item[1])}\nnodes = list(nodesByDistance.keys())\nnode = nodes[0]\ntype = node.type()\npresets = hou.hscript(\"oppresetls %s\" %node.path())[0].split(\"\\n\")\n\n# function to load presets\ndef loadPresetFunc(preset):\n    def wrapper(**kwargs):\n        hou.hscript(\"oppresetload %s '%s'\" %(node.path(), preset))\n    return wrapper\n    \n# function to FIXED Color\ndef fixedColorsFunc(name, node_color, color):\n    def wrapper(**kwargs):\n        node.parm(\"enable\").set(1)\n        node.parm(\"colortype\").set(0)\n        node.setName(name, 1)\n        node.setColor(hou.Color(node_color))\n        node.parm('colorr').deleteAllKeyframes()\n        node.parm('colorg').deleteAllKeyframes()\n        node.parm('colorb').deleteAllKeyframes()\n        node.setParms({'colorr':color[0], 'colorg':color[1], 'colorb':color[2]})\n    return wrapper     \n    \n# function from Node Color\ndef fromNodeColorFunc():\n    def wrapper(**kwargs):        \n        node.parm('colorr').setExpression('node = hou.pwd()\\nc = node.color()\\nreturn c.rgb()[0]', language=hou.exprLanguage.Python, replace_expression=True)\n        node.parm('colorg').setExpression('node = hou.pwd()\\nc = node.color()\\nreturn c.rgb()[1]', language=hou.exprLanguage.Python, replace_expression=True)\n        node.parm('colorb').setExpression('node = hou.pwd()\\nc = node.color()\\nreturn c.rgb()[2]', language=hou.exprLanguage.Python, replace_expression=True)\n        #toggle on/off for refreshing\n        v = node.parm(\"deleteallcolorattribs\").eval()\n        node.parm(\"deleteallcolorattribs\").set(1-v)\n        node.parm(\"deleteallcolorattribs\").set(v)\n    return wrapper   \n    \n    \n# function to NEXT\ndef nextFunc(type, name):\n    def wrapper(**kwargs):\n        null = node.parent().createNode(type)\n        null.setName(name, 1)\n        null.setNextInput(node)    \n        null.moveToGoodPosition()\n        null.setDisplayFlag(1)\n        null.setSelected(1)\n    return wrapper     \n    \n        \n# Build a menu from preset elements    \nmenu = {}\nfor slot, preset in zip(slots, presets[:2]):\n    menu[slot] = {\n        \"type\": \"script_action\",\n        \"label\": preset,\n        \"script\": loadPresetFunc(preset),\n        }\n\n\n\n# Add static elements        \nmenu[\"nw\"]= {\n        \"type\": \"script_action\",\n        \"label\": \"RED\",\n        \"icon\": \"SOP_color\",\n        \"script\": fixedColorsFunc('Cd_red', (1,0,0), (1, 0.25, 0)),  }\n\nmenu[\"n\"]= {\n        \"type\": \"script_action\",\n        \"label\": \"Green\",\n        \"icon\": \"SOP_color\",\n        \"script\": fixedColorsFunc('Cd_green', (0.145,0.667,0.557), (0.25, 0.5, 0)),  }\n        \nmenu[\"ne\"]= {\n        \"type\": \"script_action\",\n        \"label\": \"Blue\",\n        \"icon\": \"SOP_color\",\n        \"script\": fixedColorsFunc('Cd_blue', (0.095,0.37,0.69), (0, 0.25, 0.5)),  }        \n        \nmenu[\"w\"]= {\n        \"type\": \"script_action\",\n        \"label\": \"From Node\",\n        \"icon\": \"SOP_color\",\n        \"script\": fromNodeColorFunc(),  }  \n        \n        \nmenu[\"s\"]= {\n        \"type\": \"script_action\",\n        \"label\": \"NEXT: Transform\",\n        \"icon\": \"SOP_xform\",\n        \"script\": nextFunc('xform', 'transform'),    }\n        \nradialmenu.setRadialMenu(menu)\n\n"
}
